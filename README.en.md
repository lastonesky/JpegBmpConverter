# JpegBmpConverter

[中文文档 (Chinese README)](README.md)

> ⚠️ Important Notice: This project is entirely generated by AI.  
> The code and documentation are AI-generated for learning and research.

**Platform & Tech: C# / .NET 8, Cross-platform (Windows / Linux / macOS)**

Pure C# implementation of a JPEG decoder and a BMP→JPEG encoder, enabling bidirectional conversion without relying on System.Drawing or other image libraries. The decoding part is inspired by Pillow's `JpegDecode.c`, and the encoding part implements standard DCT, quantization, ZigZag, and Huffman coding.

## Features

- Pure C# implementation; no System.Drawing, ImageSharp, or Skia
- .NET 8 cross-platform: runs on Windows/Linux/macOS
- Standards-based: follows baseline JPEG (SOF0), inspired by Pillow's `JpegDecode.c`
- Complete decoding: parsing, Huffman decode, dequantization, IDCT, YCbCr→RGB
- Basic encoding: BMP→JPEG (DCT, quantization, ZigZag, Huffman) with adjustable quality (1–100, default 75)
- Supports grayscale and color images
- Outputs standard BMP or JPEG files

## Project Structure

```
JpegBmpConverter/
├── src/
│   ├── Program.cs                 # Main entry point and CLI parsing
│   ├── JpegEncoder.cs             # JPEG encoder core (DCT/quant/ZigZag/Huffman)
│   ├── HuffmanTable.cs            # Huffman table construction and codes
│   ├── HuffmanDecoder.cs          # Huffman bitstream decoder
│   ├── DctProcessor.cs            # DCT/IDCT and color space processing
│   ├── BmpReader.cs               # BMP reader (for BMP→JPEG)
│   ├── BmpWriter.cs               # BMP writer (for JPEG→BMP)
│   ├── PillowStyleJpegDecoder.cs  # Pillow-style decoder (learning/reference)
│   ├── SilentConsole.cs           # Console output wrapper
│   ├── BmpToJpegProgram.cs        # Sample entry for BMP→JPEG encoding
│   └── JpegBmpConverter.csproj    # Project file
├── README.md
├── README.en.md
└── .gitignore
```

## Core Components

### 1) Decoding Core (JPEG→BMP)
- JPEG segment parsing (SOI, APP0, DQT, SOF, DHT, SOS)
- Quantization and Huffman tables extraction
- Huffman decoding and dequantization
- 8×8 block IDCT and inverse ZigZag reordering
- YCbCr→RGB conversion and chroma upsampling
- BMP file writing (24bpp/8bpp)

### 2) Encoding Core (BMP→JPEG)
- BMP pixel reading and normalization
- 8×8 block DCT and quantization (quality adjustable)
- ZigZag scan and entropy coding (Huffman)
- Baseline JPEG output (JFIF, DQT, DHT, SOF, SOS, scan data)

## Build and Run

### Prerequisites
- .NET SDK 8.0 or later (use .NET CLI or Visual Studio 2022)

### Build
```bash
cd src
dotnet build -c Release
```

### Run
```bash
# Show help (prints usage when no arguments)
dotnet run --project src/JpegBmpConverter.csproj --

# JPEG → BMP
dotnet run --project src/JpegBmpConverter.csproj -- input.jpg output.bmp

# BMP → JPEG (optional quality, default 75)
dotnet run --project src/JpegBmpConverter.csproj -- input.bmp output.jpg 75
```

## Usage

### Command Syntax
```
# JPEG → BMP
JpegBmpConverter.exe <input JPEG> <output BMP>

# BMP → JPEG (optional quality)
JpegBmpConverter.exe <input BMP> <output JPEG> [quality]
```

### Examples (Windows/PowerShell)
```powershell
# Single-file conversion
dotnet run --project src/JpegBmpConverter.csproj -- photo.jpg photo.bmp
dotnet run --project src/JpegBmpConverter.csproj -- sample.bmp sample.jpg 80

# Batch JPEG → BMP conversion
Get-ChildItem -Filter *.jpg | ForEach-Object {
  $dst = [System.IO.Path]::ChangeExtension($_.FullName, 'bmp')
  dotnet run --project src/JpegBmpConverter.csproj -- $_.FullName $dst
}

# Batch BMP → JPEG conversion (quality 75)
Get-ChildItem -Filter *.bmp | ForEach-Object {
  $dst = [System.IO.Path]::ChangeExtension($_.FullName, 'jpg')
  dotnet run --project src/JpegBmpConverter.csproj -- $_.FullName $dst 75
}
```

## Technical Implementation

### Decoding Flow (JPEG→BMP)
1. Header validation: check SOI marker
2. Segment parsing: APP0, DQT, SOF, DHT, SOS
3. Tables extraction: quantization and Huffman tables
4. Entropy decoding: Huffman decode and dequantization
5. Inverse transform: 8×8 IDCT and inverse ZigZag
6. Color conversion: YCbCr→RGB with chroma upsampling
7. BMP output: write standard BMP

### Encoding Flow (BMP→JPEG)
1. Pixel reading: load BMP and normalize pixel format
2. Block processing: split into 8×8 blocks, apply DCT
3. Quantization: adjust strength by quality parameter
4. ZigZag: linearize 8×8 coefficients in ZigZag order
5. Entropy coding: DC/AC Huffman coding
6. File generation: write JFIF, DQT, DHT, SOF, SOS, scan data

### Key Algorithms
- Huffman decode/encode: table generation and bitstream processing
- DCT/IDCT: transform and inverse transform on 8×8 blocks
- Quantization/dequantization: JPEG-standard tables scaled by quality
- Color space: YCbCr and RGB conversions

## Limitations and Notes

1. Educational implementation: some advanced JPEG features are not implemented (e.g., progressive JPEG)
2. Performance: correctness over optimization; further tuning is possible
3. Compatibility: baseline JPEG (SOF0) supported; limited support for progressive/multi-scan
4. Encoding: basic pipeline with adjustable quality; subsampling and advanced features are limited
5. Error handling: common paths handled; complex edge cases may need improvements

## License

This project is for learning and research purposes. It references ideas from Pillow and adheres to the relevant open-source licenses.

## Contributing

Contributions are welcome. Please:
1. Avoid introducing third-party image processing libraries
2. Keep the code educational and readable
3. Add appropriate comments and documentation